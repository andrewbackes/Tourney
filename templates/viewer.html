<html>
	<head>
		<title>Game Dashboard</title>
		<script type="text/javascript" src="https://www.google.com/jsapi"></script>
		<script>
			google.load('visualization', '1.0', {packages: ['line', 'corechart', 'bar', 'table']});
		</script>
		<link href="resources/graph_style.css" rel="stylesheet" type="text/css">
		<script>
			var color_blue = '#009bd0';
			var color_lblue = '#cedef3';
			var color_dblue = '#003242';
			var color_purple = '#993CF3';
			var color_orange = '#e89800';
			var color_green = '#7CBC2D';
			var color_gray = '#808080';
			var color_dgray = '#333';
			
			var time_color = ['white', color_green];
			var time_grid = color_dgray;

			var depth_color = ['white', color_orange];
			var depth_grid = color_dgray;
			
			var score_color = ['white', color_purple];
			var score_grid = color_dgray;

			var startingFEN = "rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1";

			var fens = [
				{{ range $i, $v := .History }} "{{$v}}",
				{{ end }}				
			];

			var game_data = [    
				['Ply', 'Move', 'Score', 'Time', 'Depth'],
				{{ range $i, $v := .MoveList }}{{ $analysis := (index $.AnalysisList $i) }} [{{$i}}, "{{$v}}",{{ $analysis.Score }},{{ $analysis.Time }},{{ $analysis.Depth }}],
				{{ end }}
			];

		/* ********************************************************************************

			POPULATE DATA VARIABLES:
		
		******************************************************************************** */

			var SCORE_BOUND = 1800;
			// Bound the scores so we don't have charts that overflow
			for( var i = 1; i < game_data.length; i++ ) {
				if (i % 2 == 0) {
					game_data[i][2] = -game_data[i][2];
				}
				if(game_data[i][2] > SCORE_BOUND) {
					game_data[i][2] = SCORE_BOUND;
				} else if (game_data[i][2] < -SCORE_BOUND) {
					game_data[i][2] = -SCORE_BOUND;
				}
			}

			var max_score=game_data[1][2];
			var max_time=game_data[1][3];
			var max_depth=game_data[1][4];

			var times =  [ ['Move#', 'White Time',  'Black Time'] ];
			var depths = [ ['Move#', 'White Depth', 'Black Depth'] ];
			var scores = [ ['Move#', "White Score", 'Black Score'] ];
			
			var j = 1;
			for( var i = 1; i < game_data.length-1; i+=2 ) {
				if(-game_data[i][2] > max_score) { max_score = -game_data[i][2]; }
				if(game_data[i+1][2] > max_score) { max_score = game_data[i+1][2]; }
				if(game_data[i][3] > max_time) { max_time = game_data[i][3]; }
				if(game_data[i+1][3] > max_time) { max_time = game_data[i+1][3]; }
				if(game_data[i][4] > max_depth) { max_depth = game_data[i][4]; }
				if(game_data[i+1][4] > max_depth) { max_depth = game_data[i+1][4]; }

				times.push( [ j, game_data[i][3]/1000, game_data[i+1][3]/1000 ]);
				depths.push( [ j, game_data[i][4], game_data[i+1][4] ]);
				scores.push( [ j, game_data[i][2], game_data[i+1][2] ]);
				j++;
			}
			var move_table_data = [    
				 ['Number', 'Move', 'Score', 'Time', 'Depth']
			];
			for( var i = 1; i < game_data.length; i++ ) {
				var number = game_data[i][0]/2 +1;
				var move = game_data[i][1];
				var player = 0;
				if(number%1 == 0.5) {
					player = 1;
					number="";
					move = "..." + move;
				}
				var style = "text-shadow: 1px 1px 4px #000000;";
				var score_pos = 'position:relative;left:45%;width:'+ ((game_data[i][2]/max_score)*45) +'%;';
				if (game_data[i][2] < 0) {
					score_pos = 'position:relative;left:'+(45-((-game_data[i][2]/max_score)*45))+'%;width:'+ ((-game_data[i][2]/max_score)*45) +'%;';
				}
				var score_div = '<div style="'+style+score_pos+'background:'+score_color[player] +';">'+game_data[i][2]+'</div>';
				var time_div = '<div style="'+style+'width:'+ ( (game_data[i][3]/(max_time*1.25))*100 ) +'%;background:'+time_color[player] +';">'+game_data[i][3]+'</div>';
				var depth_div = '<div style="'+style+'width:'+ ( (game_data[i][4]/(max_depth*1.25))*100 ) +'%;background:'+depth_color[player] +';">'+game_data[i][4]+'</div>';
				move_table_data.push([number,move,score_div,time_div,depth_div]);
			}

		</script>
		<script src="resources/board.js"></script>
		<script src="resources/graphs.js"></script>
		
	</head>
	<body>
		<div id="time_chart"></div>
		<div id="depth_chart"></div>
		<div width="800px" height="350px" style="width:800px;height:350px;position:relative;">
			<div id="board_container" style="float:left;">
				<div id="board">
					<script>
						for(i=0;i<64;i++) {
							var rank = Math.floor(i/8)+1;
							var file = Math.floor(i%8)+1;
							var className = "dark_square";
							if((i%2 == 1 && rank%2==1)||(i%2 == 0 && rank%2==0)) {className = "light_square";}
							var b = Math.floor(i/8)*40;
							var l = Math.floor(i%8)*40;
							var idName = String.fromCharCode(96+file) + rank.toString();
							document.write("<div class='"+className+"' id='"+idName+"' style='position:absolute;left:" + l + "px;bottom:" + b+ "px;'>"+idName+"</div>");
						}
					</script>
				</div>
	        </div>
	        <div id="move_table" style="float:right;"></div>
    	</div>
		<div id="score_chart"></div>
		<div id="timeline"></div>
		<div id="debug"></div>
		<script>
			setNewBoard();
		</script>
	</body>
</html>